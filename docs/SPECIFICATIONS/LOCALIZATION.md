# ğŸŒ Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ² OblikFlow

**Ğ”Ğ°Ñ‚Ğ°:** 2026-01-14  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0.0

---

## ğŸ“‹ ĞĞ±Ğ·Ğ¾Ñ€

OblikFlow Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ **8 ÑĞ·Ñ‹ĞºĞ¾Ğ²** Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ° **ISO 639-1**.

### ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ ÑĞ·Ñ‹ĞºĞ¸:

| ĞšĞ¾Ğ´  | Ğ¯Ğ·Ñ‹Ğº        | ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (native) |
| ---- | ----------- | ----------------- |
| `uk` | Ğ£ĞºÑ€Ğ°Ğ¸Ğ½ÑĞºĞ¸Ğ¹  | Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°        |
| `en` | ĞĞ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹  | English           |
| `pl` | ĞŸĞ¾Ğ»ÑŒÑĞºĞ¸Ğ¹    | Polski            |
| `ru` | Ğ ÑƒÑÑĞºĞ¸Ğ¹     | Ğ ÑƒÑÑĞºĞ¸Ğ¹           |
| `de` | ĞĞµĞ¼ĞµÑ†ĞºĞ¸Ğ¹    | Deutsch           |
| `fr` | Ğ¤Ñ€Ğ°Ğ½Ñ†ÑƒĞ·ÑĞºĞ¸Ğ¹ | FranÃ§ais          |
| `sk` | Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ†ĞºĞ¸Ğ¹   | SlovenÄina        |
| `es` | Ğ˜ÑĞ¿Ğ°Ğ½ÑĞºĞ¸Ğ¹   | EspaÃ±ol           |

---

## ğŸ¯ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ”Ğ²Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ·Ñ‹ĞºĞ°:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Public Pages (Landing, Login)      â”‚
â”‚  âœ Cookie (locale)                  â”‚
â”‚  âœ Browser language                 â”‚
â”‚  âœ DEFAULT_LOCALE (.env)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workspace (Internal Pages)         â”‚
â”‚  âœ Enterprise.default_locale        â”‚
â”‚  âœ DEFAULT_LOCALE (.env)            â”‚
â”‚  âœ Hardcoded fallback (uk)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `locales`

```sql
CREATE TABLE locales (
  code VARCHAR(5) PRIMARY KEY,           -- ISO 639-1: uk, en, pl...
  name_native VARCHAR(50) NOT NULL,      -- Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°, English
  name_en VARCHAR(50) NOT NULL,          -- Ukrainian, English
  is_active BOOLEAN DEFAULT TRUE,        -- Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°
  created_at timestamptz DEFAULT now()
);
```

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `enterprises`

```sql
ALTER TABLE enterprises
ADD COLUMN default_locale VARCHAR(10) DEFAULT NULL;

-- Constraint: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ ISO 639-1 ĞºĞ¾Ğ´Ñ‹
CHECK (default_locale ~ '^[a-z]{2}$' OR default_locale IS NULL)

-- Foreign Key Ğº ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸ĞºÑƒ
FOREIGN KEY (default_locale) REFERENCES locales(code)
```

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** `default_locale` Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ `NULL` - Ğ² ÑÑ‚Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `DEFAULT_LOCALE` Ğ¸Ğ· `.env`.

---

## ğŸ”§ Environment Variables

### `.env` Ğ¸Ğ»Ğ¸ `.env.local`:

```bash
# Ğ¯Ğ·Ñ‹Ğº Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ workspace (ĞµÑĞ»Ğ¸ default_locale = NULL)
DEFAULT_LOCALE=uk

# Fallback ÑĞ·Ñ‹Ğº (ĞµÑĞ»Ğ¸ DEFAULT_LOCALE Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)
FALLBACK_LOCALE=en
```

---

## ğŸŒ API

### 1. **GET /api/locales** (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ endpoint)

ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ².

**ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸!**

**Response:**

```json
{
  "data": [
    {
      "code": "uk",
      "name_native": "Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°",
      "name_en": "Ukrainian",
      "is_active": true
    },
    {
      "code": "en",
      "name_native": "English",
      "name_en": "English",
      "is_active": true
    }
    // ... Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ¸
  ]
}
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

- Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ `<select>` Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ·Ñ‹ĞºĞ°
- ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ¾Ğ² Ğ½Ğ° Ñ€Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

---

### 2. **Enterprise API**

#### GET /api/enterprises

```json
{
  "data": [
    {
      "id": "uuid",
      "name": "Ğ¤ĞĞŸ Ğ†Ğ²Ğ°Ğ½Ğ¾Ğ²",
      "country_code": "UA",
      "default_currency": "UAH",
      "default_locale": "uk",  // â† Ğ¯Ğ·Ñ‹Ğº Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ñ
      "status": "active",
      ...
    }
  ]
}
```

#### POST /api/enterprises

**Request:**

```json
{
  "name": "Ğ¤ĞĞŸ Ğ†Ğ²Ğ°Ğ½Ğ¾Ğ²",
  "country_code": "UA",
  "default_currency": "UAH",
  "default_locale": "uk" // â† ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾
}
```

**Response:**

```json
{
  "data": {
    "id": "uuid",
    "name": "Ğ¤ĞĞŸ Ğ†Ğ²Ğ°Ğ½Ğ¾Ğ²",
    "default_locale": "uk",
    ...
  }
}
```

#### PATCH /api/enterprises/:id

**Request:**

```json
{
  "default_locale": "en" // Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº workspace
}
```

---

## ğŸ’» Frontend Integration

### Cookie Ğ´Ğ»Ñ Public Pages

```typescript
// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ·Ñ‹Ğº Ğ² cookie
document.cookie = `locale=uk; path=/; max-age=31536000`; // 1 Ğ³Ğ¾Ğ´

// ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ
function getCookieLocale(): string | null {
  const match = document.cookie.match(/locale=([a-z]{2})/);
  return match ? match[1] : null;
}
```

---

### Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ·Ñ‹ĞºĞ° Ğ½Ğ° Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğµ

```typescript
import { useRouter } from "next/router";
import { useEnterprise } from "@/hooks/useEnterprise";
import Cookies from "js-cookie";

function getCurrentLocale(): string {
  const router = useRouter();
  const { enterprise } = useEnterprise();

  // 1. Workspace pages â†’ ÑĞ·Ñ‹Ğº Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ñ
  if (router.pathname.startsWith("/workspace")) {
    return (
      enterprise?.default_locale ||
      process.env.NEXT_PUBLIC_DEFAULT_LOCALE ||
      "uk"
    );
  }

  // 2. Public pages â†’ cookie Ğ¸Ğ»Ğ¸ browser
  const cookieLocale = Cookies.get("locale");
  if (cookieLocale) return cookieLocale;

  const browserLocale = navigator.language.split("-")[0]; // en-US â†’ en
  if (SUPPORTED_LOCALES.includes(browserLocale)) {
    return browserLocale;
  }

  // 3. Fallback
  return process.env.NEXT_PUBLIC_DEFAULT_LOCALE || "uk";
}
```

---

### Ğ¡ĞµĞ»ĞµĞºÑ‚ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞ·Ñ‹ĞºĞ°

```typescript
import { useEffect, useState } from "react";
import { useRouter } from "next/router";

function LanguageSelector() {
  const [locales, setLocales] = useState([]);
  const [currentLocale, setCurrentLocale] = useState(getCurrentLocale());

  useEffect(() => {
    // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ·Ñ‹ĞºĞ¾Ğ² Ğ¸Ğ· API
    fetch("/api/locales")
      .then((res) => res.json())
      .then((data) => setLocales(data.data));
  }, []);

  const handleChange = (newLocale: string) => {
    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² cookie
    Cookies.set("locale", newLocale, { expires: 365 });

    // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ i18n
    window.location.reload();
  };

  return (
    <select
      value={currentLocale}
      onChange={(e) => handleChange(e.target.value)}
    >
      {locales.map((locale) => (
        <option key={locale.code} value={locale.code}>
          {locale.name_native}
        </option>
      ))}
    </select>
  );
}
```

---

## ğŸ¨ i18n Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸

### Next.js + i18next

```bash
npm install next-i18next i18next react-i18next
```

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²:**

```
public/
  locales/
    uk/
      common.json
      workspace.json
    en/
      common.json
      workspace.json
    pl/
      common.json
      workspace.json
    ...
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ `uk/common.json`:**

```json
{
  "welcome": "Ğ›Ğ°ÑĞºĞ°Ğ²Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼Ğ¾",
  "login": "Ğ£Ğ²Ñ–Ğ¹Ñ‚Ğ¸",
  "signup": "Ğ—Ğ°Ñ€ĞµÑ”ÑÑ‚Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ÑÑ",
  "enterprise": {
    "create": "Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ñ–Ğ´Ğ¿Ñ€Ğ¸Ñ”Ğ¼ÑÑ‚Ğ²Ğ¾",
    "settings": "ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ"
  }
}
```

---

## ğŸ”„ Workflow

### 1. Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ / Login (Public Pages)

```
User visits landing page
  â†“
Check cookie locale â†’ Set i18n
  â†“
No cookie? â†’ Use browser language or DEFAULT_LOCALE
  â†“
Show language selector
  â†“
User selects "Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°" â†’ Save to cookie â†’ Reload
```

### 2. Workspace (Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ°)

```
User enters workspace
  â†“
Fetch enterprise data (GET /api/enterprises/:id)
  â†“
enterprise.default_locale = "uk" â†’ Set i18n to "uk"
  â†“
Ignore cookie! Use enterprise locale
  â†“
Owner can change via Settings â†’ PATCH /api/enterprises/:id { default_locale: "en" }
```

---

## âœ… Validation

### Backend (NestJS)

```typescript
import { IsString, Matches, IsOptional } from "class-validator";

export class CreateEnterpriseDto {
  @IsString()
  @Matches(/^[a-z]{2}$/, { message: "default_locale must be ISO 639-1 code" })
  @IsOptional()
  default_locale?: string;
}
```

### Database CHECK constraint

```sql
CHECK (default_locale ~ '^[a-z]{2}$' OR default_locale IS NULL)
```

---

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸

### 1. Public page Ğ±ĞµĞ· cookie

**Expected:** Ğ¯Ğ·Ñ‹Ğº = browser language Ğ¸Ğ»Ğ¸ DEFAULT_LOCALE

### 2. Public page Ñ cookie `locale=pl`

**Expected:** Ğ¯Ğ·Ñ‹Ğº = pl (Polish)

### 3. Workspace Ñ `default_locale = "uk"`

**Expected:** Ğ¯Ğ·Ñ‹Ğº = uk, cookie Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ

### 4. Workspace Ñ `default_locale = NULL`

**Expected:** Ğ¯Ğ·Ñ‹Ğº = DEFAULT_LOCALE Ğ¸Ğ· .env (uk)

### 5. Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ¿Ñ€ĞµĞ´Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ñ

**Request:** `PATCH /api/enterprises/:id { default_locale: "de" }`  
**Expected:** Workspace Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ Ñ Ğ½ĞµĞ¼ĞµÑ†ĞºĞ¸Ğ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ¼

---

## ğŸ“š Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹

- [OpenAPI Specification](../docs/api-specifications/openapi/openapi-v1.yaml)
- [Database Schema](../database/migrations/000_init_schema.sql)
- [Frontend API Contract](../docs/FRONTEND/API_CONTRACT.md)

---

## ğŸš€ Roadmap

- âœ… **v1.0:** ISO 639-1 ĞºĞ¾Ğ´Ñ‹ (uk, en, pl, ru, de, fr, sk, es)
- â¬œ **v1.1:** BCP 47 Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² (en-US, en-GB)
- â¬œ **v1.2:** Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ñ‚Ñ‹/Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ñƒ
- â¬œ **v1.3:** Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ‡Ğ¸ÑĞµĞ»/Ğ²Ğ°Ğ»ÑÑ‚ Ğ¿Ğ¾ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ñƒ

---

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0.0  
**Ğ”Ğ°Ñ‚Ğ°:** 2026-01-14  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… Implemented
