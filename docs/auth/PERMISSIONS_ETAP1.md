# –°–∏—Å—Ç–µ–º–∞ Permissions - –≠—Ç–∞–ø 1 (–ë–∞–∑–æ–≤–∞—è)

**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0 (MVP)  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **–±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä permissions** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ MVP.

**–°–ø–∏—Å–æ–∫ permissions –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è:**
- üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏
- üîÑ –ü–æ –º–µ—Ä–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- üîÑ –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Ä–æ–ª—è–º

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π!**

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ permissions](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-permissions)
3. [–ë–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä permissions](#–±–∞–∑–æ–≤—ã–π-–Ω–∞–±–æ—Ä-permissions)
4. [Seed –¥–∞–Ω–Ω—ã–µ](#seed-–¥–∞–Ω–Ω—ã–µ)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –∫–æ–¥–µ](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–ø—Ä–∞–≤-–≤-–∫–æ–¥–µ)
6. [–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 1](#–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-—ç—Ç–∞–ø–∞-1)

---

## –û–±–∑–æ—Ä

### –ß—Ç–æ —Ç–∞–∫–æ–µ permissions?

**Permissions** - —ç—Ç–æ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º —Å–∏—Å—Ç–µ–º—ã.

–§–æ—Ä–º–∞—Ç: `module:action`
- `module` - –º–æ–¥—É–ª—å —Å–∏—Å—Ç–µ–º—ã (documents, bank, inventory)
- `action` - –¥–µ–π—Å—Ç–≤–∏–µ (read, create, update, delete, post)

–ü—Ä–∏–º–µ—Ä—ã:
- `documents:read` - –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `documents:post` - –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `bank:reconcile` - —Å–≤–µ—Ä–∫–∞ –±–∞–Ω–∫–∞
- `periods:close` - –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```
permissions (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)
    ‚Üì
role_permissions (—Å–≤—è–∑—å M2M)
    ‚Üì
roles (—Ä–æ–ª–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è)
    ‚Üì
enterprise_memberships (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å + —Ä–æ–ª—å)
```

### –£–ø—Ä–æ—â–µ–Ω–∏–µ –Ω–∞ –≠—Ç–∞–ø–µ 1

**Owner –∏ Admin –∏–º–µ—é—Ç –í–°–ï permissions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

```typescript
// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
if (isOwner || isAdmin) {
  return true; // –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
}

// –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ –≠—Ç–∞–ø–µ 1
return false;
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ permissions

### –¢–∞–±–ª–∏—Ü–∞ permissions

```sql
CREATE TABLE permissions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(100) UNIQUE NOT NULL,  -- 'documents:read'
  description TEXT
);
```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã (seed)
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ permissions –¥–ª—è –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

### –¢–∞–±–ª–∏—Ü–∞ role_permissions

```sql
CREATE TABLE role_permissions (
  role_id UUID NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
  permission_id UUID NOT NULL REFERENCES permissions(id) ON DELETE CASCADE,
  PRIMARY KEY (role_id, permission_id)
);
```

**–ö–∞–∫ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–æ–ª—å "admin"
2. –≠—Ç–æ–π —Ä–æ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –í–°–ï permissions
3. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å "admin"
4. –ß–µ—Ä–µ–∑ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ permissions

---

## –ë–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä permissions

### ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï

–≠—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ —è–≤–ª—è–µ—Ç—Å—è **—Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ç–æ—á–∫–æ–π** –∏ –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### 1. Documents (–î–æ–∫—É–º–µ–Ω—Ç—ã)

```sql
INSERT INTO permissions (code, description) VALUES
  ('documents:read', 'View documents'),
  ('documents:create', 'Create new documents'),
  ('documents:update', 'Update draft documents'),
  ('documents:delete', 'Delete draft documents'),
  ('documents:post', 'Post documents to ledger'),
  ('documents:void', 'Void posted documents');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ, –ø—Ä–æ–¥–∞–∂–∞, –≤–æ–∑–≤—Ä–∞—Ç)
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ
- –ü—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–º–µ–Ω—É –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è

### 2. Periods (–ü–µ—Ä–∏–æ–¥—ã)

```sql
INSERT INTO permissions (code, description) VALUES
  ('periods:read', 'View accounting periods'),
  ('periods:create', 'Create new periods'),
  ('periods:close', 'Close accounting periods'),
  ('periods:reopen', 'Reopen closed periods');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ –≥–æ–¥–∞ vs –º–µ—Å—è—Ü–∞
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É –≤ –∑–∞–∫—Ä—ã—Ç—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö

### 3. Enterprise Settings (–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è)

```sql
INSERT INTO permissions (code, description) VALUES
  ('enterprise:read', 'View enterprise settings'),
  ('enterprise:update', 'Update enterprise settings'),
  ('enterprise:members', 'Manage enterprise members'),
  ('enterprise:delete', 'Delete/archive enterprise');
```

### 4. Bank (–ë–∞–Ω–∫)

```sql
INSERT INTO permissions (code, description) VALUES
  ('bank:read', 'View bank accounts and transactions'),
  ('bank:import', 'Import bank statements'),
  ('bank:reconcile', 'Reconcile bank transactions'),
  ('bank:allocate', 'Allocate bank payments to documents');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ —Ä–∞–∑–Ω—ã–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞
- –ü—Ä–∞–≤–∞ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ API
- –ü—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Å—á–µ—Ç–æ–≤

### 5. Inventory (–°–∫–ª–∞–¥)

```sql
INSERT INTO permissions (code, description) VALUES
  ('inventory:read', 'View inventory and stock levels'),
  ('inventory:create', 'Create inventory operations'),
  ('inventory:manage', 'Manage inventory points'),
  ('inventory:count', 'Perform stock counting'),
  ('inventory:reserve', 'Create and manage reservations');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å–∫–ª–∞–¥—ã
- –ü—Ä–∞–≤–∞ –Ω–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é
- –ü—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–∑–µ—Ä–≤—ã
- –ü—Ä–∞–≤–∞ –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ

### 6. Reports (–û—Ç—á–µ—Ç—ã)

```sql
INSERT INTO permissions (code, description) VALUES
  ('reports:view', 'View financial reports'),
  ('reports:export', 'Export reports to PDF/Excel'),
  ('reports:custom', 'Create custom reports');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤ (–±–∞–ª–∞–Ω—Å, P&L, tax)
- –ü—Ä–∞–≤–∞ –Ω–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

### 7. Counterparties (–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã)

```sql
INSERT INTO permissions (code, description) VALUES
  ('counterparties:read', 'View counterparties'),
  ('counterparties:create', 'Create counterparties'),
  ('counterparties:update', 'Update counterparties'),
  ('counterparties:delete', 'Delete counterparties');
```

### 8. Products (–¢–æ–≤–∞—Ä—ã)

```sql
INSERT INTO permissions (code, description) VALUES
  ('products:read', 'View products catalog'),
  ('products:create', 'Create products'),
  ('products:update', 'Update products'),
  ('products:delete', 'Delete products');
```

### 9. Tax (–ù–∞–ª–æ–≥–∏)

```sql
INSERT INTO permissions (code, description) VALUES
  ('tax:read', 'View tax information'),
  ('tax:configure', 'Configure tax profiles'),
  ('tax:reports', 'Generate tax reports');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
- –ü—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç—á–µ—Ç–æ–≤ –≤ –Ω–∞–ª–æ–≥–æ–≤—É—é

### 10. Recurring Operations (–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

```sql
INSERT INTO permissions (code, description) VALUES
  ('recurring:read', 'View recurring operations'),
  ('recurring:create', 'Create recurring templates'),
  ('recurring:execute', 'Execute recurring operations');
```

**–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π (–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è, –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è)
- –ü—Ä–∞–≤–∞ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

---

## Seed –¥–∞–Ω–Ω—ã–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö permissions

```sql
-- File: supabase/migrations/XXXXX_seed_permissions.sql

-- ====================================
-- –ë–ê–ó–û–í–´–ï PERMISSIONS (–≠—Ç–∞–ø 1)
-- ====================================
-- ‚ö†Ô∏è –≠—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è!

-- Documents
INSERT INTO permissions (code, description) VALUES
  ('documents:read', 'View documents'),
  ('documents:create', 'Create new documents'),
  ('documents:update', 'Update draft documents'),
  ('documents:delete', 'Delete draft documents'),
  ('documents:post', 'Post documents to ledger'),
  ('documents:void', 'Void posted documents');

-- Periods
INSERT INTO permissions (code, description) VALUES
  ('periods:read', 'View accounting periods'),
  ('periods:create', 'Create new periods'),
  ('periods:close', 'Close accounting periods'),
  ('periods:reopen', 'Reopen closed periods');

-- Enterprise
INSERT INTO permissions (code, description) VALUES
  ('enterprise:read', 'View enterprise settings'),
  ('enterprise:update', 'Update enterprise settings'),
  ('enterprise:members', 'Manage enterprise members'),
  ('enterprise:delete', 'Delete/archive enterprise');

-- Bank
INSERT INTO permissions (code, description) VALUES
  ('bank:read', 'View bank accounts and transactions'),
  ('bank:import', 'Import bank statements'),
  ('bank:reconcile', 'Reconcile bank transactions'),
  ('bank:allocate', 'Allocate bank payments to documents');

-- Inventory
INSERT INTO permissions (code, description) VALUES
  ('inventory:read', 'View inventory and stock levels'),
  ('inventory:create', 'Create inventory operations'),
  ('inventory:manage', 'Manage inventory points'),
  ('inventory:count', 'Perform stock counting'),
  ('inventory:reserve', 'Create and manage reservations');

-- Reports
INSERT INTO permissions (code, description) VALUES
  ('reports:view', 'View financial reports'),
  ('reports:export', 'Export reports to PDF/Excel'),
  ('reports:custom', 'Create custom reports');

-- Counterparties
INSERT INTO permissions (code, description) VALUES
  ('counterparties:read', 'View counterparties'),
  ('counterparties:create', 'Create counterparties'),
  ('counterparties:update', 'Update counterparties'),
  ('counterparties:delete', 'Delete counterparties');

-- Products
INSERT INTO permissions (code, description) VALUES
  ('products:read', 'View products catalog'),
  ('products:create', 'Create products'),
  ('products:update', 'Update products'),
  ('products:delete', 'Delete products');

-- Tax
INSERT INTO permissions (code, description) VALUES
  ('tax:read', 'View tax information'),
  ('tax:configure', 'Configure tax profiles'),
  ('tax:reports', 'Generate tax reports');

-- Recurring
INSERT INTO permissions (code, description) VALUES
  ('recurring:read', 'View recurring operations'),
  ('recurring:create', 'Create recurring templates'),
  ('recurring:execute', 'Execute recurring operations');

-- ====================================
-- –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:
-- –ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–¥—É–ª–µ–π –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏
-- —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è!
-- ====================================
```

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ permissions —Ä–æ–ª–∏ "admin"

```sql
-- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è (–≤ Server Action)
-- 1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ
-- 2. –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å "admin"
-- 3. –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª–∏ –í–°–ï permissions

-- –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ –∫–æ–¥–µ:
const { data: role } = await supabase
  .from('roles')
  .insert({
    enterprise_id,
    name: 'admin',
    description: 'Enterprise Administrator'
  })
  .select()
  .single();

// –ù–∞–∑–Ω–∞—á–∏—Ç—å –í–°–ï permissions
const { data: allPermissions } = await supabase
  .from('permissions')
  .select('id');

await supabase
  .from('role_permissions')
  .insert(
    allPermissions.map(p => ({
      role_id: role.id,
      permission_id: p.id
    }))
  );
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –≤ –∫–æ–¥–µ

### –ù–∞ –≠—Ç–∞–ø–µ 1: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```typescript
// shared/hooks/usePermissions.ts
'use client';

import { useRole } from './useRole';

export function usePermissions(enterpriseId?: string) {
  const { isOwner, isAdmin, isSuperAdmin } = useRole(enterpriseId);
  
  // –ù–∞ –≠—Ç–∞–ø–µ 1: owner/admin –∏–º–µ—é—Ç –í–°–ï –ø—Ä–∞–≤–∞
  const hasFullAccess = isOwner || isAdmin || isSuperAdmin;
  
  return {
    hasPermission: (code: string) => hasFullAccess,
    hasAnyPermission: (codes: string[]) => hasFullAccess,
    hasAllPermissions: (codes: string[]) => hasFullAccess,
    permissions: hasFullAccess ? ['*'] : [], // '*' = –≤—Å–µ –ø—Ä–∞–≤–∞
  };
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

```typescript
// workspace/app/documents/page.tsx
'use client';

import { usePermissions } from '@/hooks/usePermissions';
import { useEnterpriseContext } from '@/contexts/EnterpriseContext';

export default function DocumentsPage() {
  const { currentEnterprise } = useEnterpriseContext();
  const { hasPermission } = usePermissions(currentEnterprise?.id);
  
  // –ù–∞ –≠—Ç–∞–ø–µ 1 –≤—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–µ—Ç true –¥–ª—è owner/admin
  const canCreate = hasPermission('documents:create');
  const canPost = hasPermission('documents:post');
  
  return (
    <div>
      <h1>Documents</h1>
      
      {canCreate && (
        <Button asChild>
          <Link href="/documents/new">
            Create Document
          </Link>
        </Button>
      )}
      
      <DocumentsList 
        canPost={canPost}
      />
    </div>
  );
}
```

### –í Server Actions

```typescript
// workspace/app/documents/actions.ts
'use server';

import { createClient } from '@/lib/supabase/server';

export async function postDocument(documentId: string) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    throw new Error('Unauthorized');
  }
  
  // –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
  const { data: document } = await supabase
    .from('documents')
    .select('enterprise_id')
    .eq('id', documentId)
    .single();
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ (–Ω–∞ –≠—Ç–∞–ø–µ 1: owner –∏–ª–∏ admin)
  const hasAccess = await checkUserAccess(user.id, document.enterprise_id);
  
  if (!hasAccess) {
    throw new Error('Access denied');
  }
  
  // –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
  // ...
}

async function checkUserAccess(userId: string, enterpriseId: string) {
  const supabase = await createClient();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ owner
  const { data: enterprise } = await supabase
    .from('enterprises')
    .select('owner_user_id')
    .eq('id', enterpriseId)
    .single();
  
  if (enterprise?.owner_user_id === userId) {
    return true;
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ admin
  const { data: membership } = await supabase
    .from('enterprise_memberships')
    .select('role:roles(name)')
    .eq('enterprise_id', enterpriseId)
    .eq('user_id', userId)
    .eq('status', 'active')
    .single();
  
  return membership?.role?.name === 'admin';
}
```

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 1

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ permissions**
   - Owner/Admin –∏–º–µ—é—Ç –í–°–ï –ø—Ä–∞–≤–∞
   - –ù–µ–ª—å–∑—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
   - –ù–µ—Ç —Ä–æ–ª–µ–π —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º

2. **–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ —Ä–æ–ª–∏ owner/admin –Ω–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö permissions –¥–ª—è –Ω–∏—Ö

3. **UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è permissions**
   - –ù–µ–ª—å–∑—è –≤—ã–±—Ä–∞—Ç—å –∫–∞–∫–∏–µ permissions –¥–∞—Ç—å —Ä–æ–ª–∏
   - –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Ä–æ–ª—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏

### –ß—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≠—Ç–∞–ø–µ 2

1. ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ permissions
   ```typescript
   // –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ë–î
   const { data: rolePerms } = await supabase
     .from('role_permissions')
     .select('permission:permissions(code)')
     .eq('role_id', membership.role_id);
   
   const permissions = rolePerms.map(rp => rp.permission.code);
   
   return {
     hasPermission: (code) => permissions.includes(code),
     permissions
   };
   ```

2. ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ä–æ–ª–∏ —Å –≤—ã–±–æ—Ä–æ–º permissions
   ```typescript
   // UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–ª–∏
   <RoleForm>
     <PermissionsSelector
       availablePermissions={allPermissions}
       selectedPermissions={selectedPerms}
       onChange={setSelectedPerms}
     />
   </RoleForm>
   ```

3. ‚úÖ –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º
   ```typescript
   // –ë—É—Ö–≥–∞–ª—Ç–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ documents –∏ reports
   const accountantPerms = [
     'documents:read',
     'documents:create',
     'documents:post',
     'reports:view'
   ];
   ```

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [ARCHITECTURE.md](./ARCHITECTURE.md) - –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ROLES_SYSTEM_ETAP1.md](./ROLES_SYSTEM_ETAP1.md) - –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π
- [DATABASE_SCHEMA_ETAP1.md](./DATABASE_SCHEMA_ETAP1.md) - –°—Ö–µ–º–∞ –ë–î
- [PERMISSIONS_ETAP2.md](./PERMISSIONS_ETAP2.md) - –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–≠—Ç–∞–ø 2)

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0 (–±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä –¥–ª—è MVP)
