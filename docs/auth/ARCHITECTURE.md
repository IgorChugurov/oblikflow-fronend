# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ OblikFlow

**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–í–µ—Ä—Å–∏—è:** 2.0 (—Å —É—á–µ—Ç–æ–º ERD –±—ç–∫–µ–Ω–¥–∞)

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
4. [–ü–æ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#–ø–æ—Ç–æ–∫-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
5. [–¢–æ–∫–µ–Ω—ã –∏ —Å–µ—Å—Å–∏–∏](#—Ç–æ–∫–µ–Ω—ã-–∏-—Å–µ—Å—Å–∏–∏)
6. [Cookies —Å—Ç—Ä–∞—Ç–µ–≥–∏—è](#cookies-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
7. [Middleware –∑–∞—â–∏—Ç–∞](#middleware-–∑–∞—â–∏—Ç–∞)
8. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-–±—ç–∫–µ–Ω–¥–æ–º)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### OblikFlow Platform

–ú—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–≥–æ —É—á–µ—Ç–∞ —Å **4 Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏** –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö:

```
oblikflow.com              ‚Üí site       (–≤–∏—Ç—Ä–∏–Ω–∞ + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
admin.oblikflow.com        ‚Üí admin      (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥)
workspace.oblikflow.com    ‚Üí workspace  (–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è)
platform.oblikflow.com     ‚Üí platform   (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å)
```

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **Supabase Authentication** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. **SSR-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - Next.js 15 Server Components
3. **httpOnly cookies** - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏
4. **Permission-based access** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤
5. **Multi-enterprise support** - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –º–Ω–æ–≥–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è—Ö

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü–æ—á–µ–º—É Supabase Auth + SSR?

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ (access + refresh)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions
- ‚úÖ OAuth –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (Google, GitHub)
- ‚úÖ Email verification –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
- ‚úÖ Password reset –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
- ‚úÖ Row Level Security (RLS) –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã:**

- ‚ùå NextAuth.js - –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Supabase RLS –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- ‚ùå Custom JWT - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚ùå Session-based - —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        User Browser                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  site           admin           workspace        platform        ‚îÇ
‚îÇ  (login)        (dashboard)     (accounting)     (super admin)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ              ‚îÇ                 ‚îÇ              ‚îÇ
     ‚ñº              ‚ñº                 ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Next.js Middleware Layer                       ‚îÇ
‚îÇ  ‚Ä¢ Auth check    ‚Ä¢ Token refresh    ‚Ä¢ Role validation           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ              ‚îÇ                 ‚îÇ              ‚îÇ
     ‚ñº              ‚ñº                 ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Supabase Auth Server                          ‚îÇ
‚îÇ  ‚Ä¢ JWT tokens    ‚Ä¢ OAuth    ‚Ä¢ Email verification                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ              ‚îÇ                 ‚îÇ              ‚îÇ
     ‚ñº              ‚ñº                 ‚ñº              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  PostgreSQL Database                             ‚îÇ
‚îÇ  ‚Ä¢ users                    ‚Ä¢ enterprises                        ‚îÇ
‚îÇ  ‚Ä¢ enterprise_memberships   ‚Ä¢ roles                              ‚îÇ
‚îÇ  ‚Ä¢ permissions              ‚Ä¢ role_permissions                   ‚îÇ
‚îÇ  + RLS Policies –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### Site (`oblikflow.com`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—É–±–ª–∏—á–Ω–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–í–ê–ñ–ù–û:** –ù–∞ –≠—Ç–∞–ø–µ 1 - –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –º–µ—Å—Ç–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**

- `/` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–≤–∏—Ç—Ä–∏–Ω–∞)
- `/login` - –≤—Ö–æ–¥ (email/password + Google OAuth)
- `/signup` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/reset-password` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
- `/auth/callback` - OAuth callback
- `/auth/confirm` - email verification callback

**Middleware:**

- –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø—É–±–ª–∏—á–Ω—ã–µ
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**

```
User ‚Üí site/login ‚Üí success ‚Üí redirect ‚Üí admin/
```

---

### Admin (`admin.oblikflow.com`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –ö–ê–ñ–î–û–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–ê–ñ–ù–û:** Admin –¥–æ—Å—Ç—É–ø–µ–Ω –í–°–ï–ú –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–Ω–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º!)

**Auth –Ω–∞ –≠—Ç–∞–ø–µ 1:** –ù–ï–¢ login —Å—Ç—Ä–∞–Ω–∏—Ü. –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π ‚Üí redirect site/login

**–ö—Ç–æ –≤–∏–¥–∏—Ç Admin:**

- ‚úÖ System admin (—Å—É–ø–µ—Ä–∞–¥–º–∏–Ω –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
- ‚úÖ Enterprise owner (–≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è)
- ‚úÖ Enterprise admin (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è)
- ‚úÖ Accountant (–±—É—Ö–≥–∞–ª—Ç–µ—Ä)
- ‚úÖ Warehouse manager (—Å–∫–ª–∞–¥–æ–≤—â–∏–∫)
- ‚úÖ –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—é

**–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/`):**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Your Enterprises                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üìä –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –ê                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Role: Accountant                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [Open Workspace]                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üìä –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –ë                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Role: Accountant                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [Open Workspace]                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üìä –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –í                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Role: Admin  ‚≠ê                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [Open Workspace] [‚öôÔ∏è Settings]          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üìä –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –ì                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Role: Owner  üëë                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ [Open Workspace] [‚öôÔ∏è Settings]          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  [+ Create New Enterprise]                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**

1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –≥–¥–µ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø (–ª—é–±–∞—è —Ä–æ–ª—å)
2. –ö–Ω–æ–ø–∫–∞ `Settings` —Ç–æ–ª—å–∫–æ –¥–ª—è owner/admin —Ä–æ–ª–µ–π
3. –ö–ª–∏–∫ `Open Workspace` ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ workspace

**–°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—Ç–æ–ª—å–∫–æ owner/admin):**

- `/verify-email` - —ç–∫—Ä–∞–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email
- `/enterprises/new` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
- `/enterprises/[id]/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
- `/enterprises/[id]/members` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

**Middleware:**

- –¢—Ä–µ–±—É–µ—Ç: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: email_verified
- –†–µ–¥–∏—Ä–µ–∫—Ç: `/verify-email` –µ—Å–ª–∏ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω

---

### Workspace (`workspace.oblikflow.com`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏

**–î–æ—Å—Ç—É–ø–Ω–æ:** –í–°–ï–ú –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –ª—é–±–æ–π —Ä–æ–ª—å—é –≤ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏

**Auth –Ω–∞ –≠—Ç–∞–ø–µ 1:** –ù–ï–¢ login —Å—Ç—Ä–∞–Ω–∏—Ü. –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π ‚Üí redirect site/login

**–ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è (–≠—Ç–∞–ø 1):**
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –±–µ–∑ cookie `current_enterprise_id`:

1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
   - –ï—Å–ª–∏ 0 –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π ‚Üí redirect admin/
   - –ï—Å–ª–∏ 1 –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ ‚Üí –≤—ã–±—Ä–∞—Ç—å –µ–≥–æ
   - –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí –≥–¥–µ owner ‚Üí –≥–¥–µ admin ‚Üí –ø–µ—Ä–≤–æ–µ –ø–æ —Å–ø–∏—Å–∫—É
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookie
4. –ü–æ–∫–∞–∑–∞—Ç—å workspace –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è

**UI –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ permissions –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –í ‚ñº] [üë§ User Menu]              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Sidebar (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é):                     ‚îÇ
‚îÇ  üìÑ Documents     ‚úÖ Visible for this role      ‚îÇ
‚îÇ  üè¶ Bank          ‚úÖ Visible for this role      ‚îÇ
‚îÇ  üì¶ Inventory     ‚ùå Hidden (no permission)     ‚îÇ
‚îÇ  üìä Reports       ‚úÖ Visible for this role      ‚îÇ
‚îÇ  ‚öôÔ∏è Settings      ‚ùå Hidden (not owner/admin)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–°—Ç—Ä–∞–Ω–∏—Ü—ã (–ø—Ä–∏–º–µ—Ä—ã):**

- `/` - –¥–∞—à–±–æ—Ä–¥ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
- `/documents` - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `/documents/new` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å permission)
- `/bank` - –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `/inventory` - —Å–∫–ª–∞–¥
- `/reports` - –æ—Ç—á–µ—Ç—ã

**Middleware:**

- –¢—Ä–µ–±—É–µ—Ç: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é + email verification
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `current_enterprise_id` cookie
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –Ω–∞–ª–∏—á–∏–µ —Ä–æ–ª–∏ –≤ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏
- –†–µ–¥–∏—Ä–µ–∫—Ç: `/admin` –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –Ω–µ—Ç cookie

---

### Platform (`platform.oblikflow.com`)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**–î–æ—Å—Ç—É–ø–Ω–æ:** –¢–æ–ª—å–∫–æ system admin (`users.is_system_admin = true`)

**Auth –Ω–∞ –≠—Ç–∞–ø–µ 1:** –ù–ï–¢ login —Å—Ç—Ä–∞–Ω–∏—Ü. –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π ‚Üí redirect site/login

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**

- `/` - –¥–∞—à–±–æ—Ä–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- `/users` - –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `/enterprises` - –≤—Å–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**Middleware:**

- –¢—Ä–µ–±—É–µ—Ç: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: `is_system_admin = true`
- –†–µ–¥–∏—Ä–µ–∫—Ç: `admin/` –µ—Å–ª–∏ –Ω–µ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –Ω–æ –Ω–µ superAdmin)
- –†–µ–¥–∏—Ä–µ–∫—Ç: `site/login` –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

## –ü–æ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ë—É—Ö–≥–∞–ª—Ç–µ—Ä)

```
1. site/signup
   ‚îú‚îÄ Email: user@example.com
   ‚îú‚îÄ Password: ********
   ‚îî‚îÄ [Sign Up] ‚Üí Supabase creates user

2. Email inbox
   ‚îî‚îÄ Click verification link
      ‚îî‚îÄ site/auth/confirm?token=xxx
         ‚îî‚îÄ Email verified ‚úÖ

3. site/login
   ‚îî‚îÄ Email/password ‚Üí success

4. Redirect ‚Üí admin/
   ‚îî‚îÄ "You don't have access to any enterprises yet"
   ‚îî‚îÄ Wait for invitation from enterprise owner

5. Owner adds user to Enterprise A (role: accountant)

6. User refreshes ‚Üí admin/
   ‚îî‚îÄ Shows: Enterprise A (Accountant)
   ‚îî‚îÄ [Open Workspace] button

7. Click [Open Workspace]
   ‚îî‚îÄ Cookie: current_enterprise_id = A
   ‚îî‚îÄ Redirect ‚Üí workspace/

8. workspace/ (Enterprise A context)
   ‚îî‚îÄ Working as Accountant ‚úÖ
   ‚îî‚îÄ UI adapted to accountant permissions
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è–º–∏

```
User logged in:
‚îú‚îÄ Enterprise A: Accountant
‚îú‚îÄ Enterprise B: Accountant
‚îú‚îÄ Enterprise C: Admin
‚îî‚îÄ Enterprise D: Owner

1. admin/ (personal dashboard)
   ‚îî‚îÄ Shows all 4 enterprises
   ‚îî‚îÄ Settings visible only for C and D

2. Click [Open Workspace] on Enterprise B
   ‚îî‚îÄ Cookie: current_enterprise_id = B
   ‚îî‚îÄ workspace/ opens in B context

3. Working in B...

4. Click [–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ B ‚ñº] in header
   ‚îî‚îÄ Dropdown shows all enterprises
   ‚îî‚îÄ Click "Enterprise C"

5. Redirect ‚Üí admin/
   ‚îî‚îÄ User selects Enterprise C
   ‚îî‚îÄ Cookie: current_enterprise_id = C
   ‚îî‚îÄ workspace/ opens in C context

6. In C context, user sees [‚öôÔ∏è Settings] (because admin role)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ó–∞—Ö–æ–¥ –Ω–∞ workspace –±–µ–∑ cookie (–∞–≤—Ç–æ–≤—ã–±–æ—Ä)

```
1. User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç workspace.oblikflow.com (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∏–ª–∏ –Ω–µ—Ç cookie)

2. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç auth
   ‚îú‚îÄ –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí redirect site/login (–≠—Ç–∞–ø 1: –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ auth)
   ‚îî‚îÄ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –¥–∞–ª–µ–µ

3. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç current_enterprise_id cookie
   ‚îú‚îÄ –ï—Å—Ç—å cookie ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø ‚Üí OK –∏–ª–∏ —Å–±—Ä–æ—Å–∏—Ç—å
   ‚îî‚îÄ –ù–ï–¢ cookie ‚Üí –∞–≤—Ç–æ–≤—ã–±–æ—Ä

4. –ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è:
   a) –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   b) –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
      - –ï—Å–ª–∏ 0 –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π ‚Üí redirect admin/
      - –ï—Å–ª–∏ 1 –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ ‚Üí –≤—ã–±—Ä–∞—Ç—å –µ–≥–æ
      - –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ:
        ‚Üí –ì–¥–µ owner? ‚Üí –í—ã–±—Ä–∞—Ç—å
        ‚Üí –ì–¥–µ admin? ‚Üí –í—ã–±—Ä–∞—Ç—å
        ‚Üí –ü–µ—Ä–≤–æ–µ –ø–æ —Å–ø–∏—Å–∫—É
   c) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookie current_enterprise_id
   d) Continue to workspace

5. workspace/ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
```

**–ö–æ–¥ middleware:**

```typescript
// workspace/middleware.ts
const enterpriseId = request.cookies.get("current_enterprise_id")?.value;

if (!enterpriseId) {
  // –ê–≤—Ç–æ–≤—ã–±–æ—Ä
  const { data: enterprises } = await supabase.rpc("get_user_enterprises", {
    p_user_id: user.id,
  });

  if (!enterprises || enterprises.length === 0) {
    return NextResponse.redirect(ADMIN_URL);
  }

  let selectedId: string;

  if (enterprises.length === 1) {
    selectedId = enterprises[0].enterprise_id;
  } else {
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: owner > admin > first
    const owned = enterprises.find((e) => e.is_owner);
    const admin = enterprises.find((e) => e.role_name === "admin");
    selectedId =
      owned?.enterprise_id ||
      admin?.enterprise_id ||
      enterprises[0].enterprise_id;
  }

  const response = NextResponse.next();
  response.cookies.set("current_enterprise_id", selectedId, {
    path: "/",
    domain: process.env.NEXT_PUBLIC_COOKIE_DOMAIN,
  });

  return response;
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω

```
1. site/login ‚Üí success (but email_verified = false)

2. Middleware catches ‚Üí redirect admin/verify-email

3. admin/verify-email
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  ‚úâÔ∏è Please verify your email           ‚îÇ
   ‚îÇ  We sent a verification link to:       ‚îÇ
   ‚îÇ  user@example.com                      ‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ  [Resend Email]  [Logout]             ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

4. Click [Resend Email] ‚Üí Supabase sends new email

5. Check inbox ‚Üí click link ‚Üí verified

6. Refresh page ‚Üí redirect ‚Üí admin/ ‚úÖ
```

---

## –¢–æ–∫–µ–Ω—ã –∏ —Å–µ—Å—Å–∏–∏

### Access Token (JWT)

```json
{
  "sub": "user-uuid",
  "email": "user@example.com",
  "role": "authenticated",
  "aud": "authenticated",
  "exp": 1705234567
}
```

- **–§–æ—Ä–º–∞—Ç:** JWT
- **–°—Ä–æ–∫ –∂–∏–∑–Ω–∏:** 1 —á–∞—Å (Supabase default)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** httpOnly cookie `sb-xxx-auth-token`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤

### Refresh Token

- **–§–æ—Ä–º–∞—Ç:** –£–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–Ω–µ JWT)
- **–°—Ä–æ–∫ –∂–∏–∑–Ω–∏:** 7 –¥–Ω–µ–π (Supabase default)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í —Ç–æ–º –∂–µ cookie
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```typescript
// –í middleware –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
export async function middleware(request: NextRequest) {
  const supabase = createServerClient({
    cookies: {
      getAll() {
        return request.cookies.getAll();
      },
      setAll(cookies) {
        // –û–±–Ω–æ–≤–ª—è–µ—Ç response.cookies
      },
    },
  });

  // –í—ã–∑–æ–≤ getUser() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã
  const {
    data: { user },
  } = await supabase.auth.getUser();

  // Response —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ cookies
  return response;
}
```

---

## Cookies —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### Production (`domain=.oblikflow.com`)

**Cookies —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ Supabase:**

```
Name: sb-xxx-auth-token
Value: { access_token, refresh_token, expires_at }
Domain: .oblikflow.com
Flags: httpOnly; Secure; SameSite=None
```

**Cookies —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –Ω–∞–º–∏:**

```
Name: current_enterprise_id
Value: "uuid-of-selected-enterprise"
Domain: .oblikflow.com
Flags: httpOnly; Secure; SameSite=Lax
```

**–†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

- ‚úÖ Cookies –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö
- ‚úÖ –ï–¥–∏–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è–º–∏ —á–µ—Ä–µ–∑ cookie

### Development (`localhost`)

**–ü—Ä–æ–±–ª–µ–º–∞:** Cookies —Å domain –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è localhost –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

1. Supabase cookies –±–µ–∑ domain (—Ç–µ–∫—É—â–∏–π –ø–æ–¥–¥–æ–º–µ–Ω)
2. localStorage –∫–∞–∫ fallback –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
3. sessionStorage –¥–ª—è enterprise_id

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å staging —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º

---

## Middleware –∑–∞—â–∏—Ç–∞

### –û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

```typescript
export async function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;

  // 1. –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
  if (isPublicRoute(pathname)) {
    return NextResponse.next();
  }

  // 2. –°–æ–∑–¥–∞–µ–º Supabase client
  const supabase = createServerClient({
    cookies: {
      getAll() {
        return request.cookies.getAll();
      },
      setAll(cookies) {
        /* —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤ response */
      },
    },
  });

  // 3. –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  const {
    data: { user },
  } = await supabase.auth.getUser();

  // 4. –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  if (!user) {
    return NextResponse.redirect(siteUrl + "/login");
  }

  // 5. –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  // ...

  return response; // –° –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ cookies
}
```

### Site middleware

```typescript
// site/middleware.ts
export const config = {
  matcher: [], // –ù–µ—Ç middleware - –≤—Å–µ –ø—É–±–ª–∏—á–Ω–æ–µ
};
```

### Admin middleware

```typescript
// admin/middleware.ts
export async function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;

  // –ü—É–±–ª–∏—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
  if (pathname === "/verify-email") {
    return NextResponse.next();
  }

  const supabase = createServerClient(/* ... */);
  const {
    data: { user },
  } = await supabase.auth.getUser();

  // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  if (!user) {
    return NextResponse.redirect(siteUrl + "/login");
  }

  // Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
  if (!user.email_confirmed_at && pathname !== "/verify-email") {
    return NextResponse.redirect(adminUrl + "/verify-email");
  }

  return NextResponse.next();
}
```

### Workspace middleware

```typescript
// workspace/middleware.ts
export async function middleware(request: NextRequest) {
  const supabase = createServerClient(/* ... */);
  const {
    data: { user },
  } = await supabase.auth.getUser();

  // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  if (!user) {
    return NextResponse.redirect(siteUrl + "/login");
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ enterprise_id –≤ cookie
  const enterpriseId = request.cookies.get("current_enterprise_id")?.value;
  if (!enterpriseId) {
    // –ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è ‚Üí admin
    return NextResponse.redirect(adminUrl);
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—é (–µ—Å—Ç—å –ª–∏ —Ä–æ–ª—å?)
  const { data: membership } = await supabase
    .from("enterprise_memberships")
    .select("role_id")
    .eq("enterprise_id", enterpriseId)
    .eq("user_id", user.id)
    .eq("status", "active")
    .single();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ owner
  const { data: enterprise } = await supabase
    .from("enterprises")
    .select("owner_user_id")
    .eq("id", enterpriseId)
    .single();

  const isOwner = enterprise?.owner_user_id === user.id;

  // –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞
  if (!membership && !isOwner) {
    const response = NextResponse.redirect(adminUrl);
    response.cookies.delete("current_enterprise_id");
    return response;
  }

  return NextResponse.next();
}
```

### Platform middleware

```typescript
// platform/middleware.ts
export async function middleware(request: NextRequest) {
  const supabase = createServerClient(/* ... */);
  const {
    data: { user },
  } = await supabase.auth.getUser();

  // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  if (!user) {
    return NextResponse.redirect(siteUrl + "/login");
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ system admin
  const { data: userData } = await supabase
    .from("users")
    .select("is_system_admin")
    .eq("id", user.id)
    .single();

  if (!userData?.is_system_admin) {
    // –ù–µ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ admin
    return NextResponse.redirect(adminUrl);
  }

  return NextResponse.next();
}
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–∏–∑ ERD)

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
users (
  id, email, name,
  is_system_admin BOOLEAN,
  email_verified BOOLEAN,
  current_subscription_id UUID
)

-- –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
enterprises (
  id, name,
  owner_user_id UUID,  -- Owner –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
  status VARCHAR(50),
  deleted_at timestamptz
)

-- –†–æ–ª–∏ (–∫–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ)
roles (
  id,
  enterprise_id UUID,
  name VARCHAR(100)
)

-- –ü—Ä–∞–≤–∞ (–≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
permissions (
  id,
  code VARCHAR(100)  -- 'documents:read', 'documents:post'
)

-- –°–≤—è–∑—å —Ä–æ–ª—å-–ø—Ä–∞–≤–∞
role_permissions (
  role_id UUID,
  permission_id UUID
)

-- –ß–ª–µ–Ω—Å—Ç–≤–æ –≤ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è—Ö
enterprise_memberships (
  enterprise_id UUID,
  user_id UUID,
  role_id UUID,
  status VARCHAR(50)
)

-- –ü–æ–¥–ø–∏—Å–∫–∏ (–≠—Ç–∞–ø 1: unlimited plan)
subscription_plans (id, code, name)
user_subscriptions (user_id, plan_id, status)
```

### Row Level Security (RLS)

```sql
-- –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
CREATE POLICY enterprise_access ON enterprises
  USING (
    -- Owner
    owner_user_id = auth.uid()
    OR
    -- Member
    id IN (
      SELECT enterprise_id
      FROM enterprise_memberships
      WHERE user_id = auth.uid()
        AND status = 'active'
    )
    OR
    -- System admin
    EXISTS (
      SELECT 1 FROM users
      WHERE id = auth.uid()
        AND is_system_admin = true
    )
  );
```

---

## ‚ùì FAQ

### –í: –ü–æ—á–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ site –Ω–∞ –≠—Ç–∞–ø–µ 1?

**–û:** –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è MVP. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö —Ç—Ä–µ–±—É–µ—Ç:

- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è auth –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Supabase redirect URLs –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–¥–æ–º–µ–Ω–∞
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞ –≠—Ç–∞–ø–µ 2:** –í—ã–Ω–µ—Å–µ–º auth –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ shared –ø–∞–∫–µ—Ç –∏ –¥–æ–±–∞–≤–∏–º login –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.

### –í: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–ª –Ω–∞ workspace/admin/platform –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)?

**–û:** Middleware –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –¥–µ–ª–∞–µ—Ç redirect –Ω–∞ `site/login`. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ `admin/`.

**–ü—Ä–∏–º–µ—Ä:**

```
User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç: workspace.oblikflow.com
   ‚Üì
Middleware: –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
   ‚Üì
Redirect: site/login
   ‚Üì
User –ª–æ–≥–∏–Ω–∏—Ç—Å—è
   ‚Üì
Redirect: admin/ (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥)
```

### –í: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–≤—ã–±–æ—Ä –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –≤ workspace?

**–û:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ workspace –±–µ–∑ cookie `current_enterprise_id`, middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:

1. –ï—Å–ª–∏ 0 –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π ‚Üí redirect admin/ (—Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ)
2. –ï—Å–ª–∏ 1 –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ ‚Üí –≤—ã–±—Ä–∞—Ç—å –µ–≥–æ
3. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí –≥–¥–µ owner ‚Üí –≥–¥–µ admin ‚Üí –ø–µ—Ä–≤–æ–µ –ø–æ —Å–ø–∏—Å–∫—É
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookie –∏ –ø–æ–∫–∞–∑–∞—Ç—å workspace

**–ü–æ—á–µ–º—É —Ç–∞–∫:** –£–ª—É—á—à–∞–µ—Ç UX - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ä–∞–±–æ—á—É—é —Å—Ä–µ–¥—É, –Ω–µ –Ω—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑.

### –í: –ß—Ç–æ –µ—Å–ª–∏ middleware –≤—ã–±—Ä–∞–ª –Ω–µ —Ç–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?

**–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ dropdown –≤ header workspace. –ê–≤—Ç–æ–≤—ã–±–æ—Ä - —ç—Ç–æ —É–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞—Ö–æ–¥–∞, –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ.

**–í –±—É–¥—É—â–µ–º (–≠—Ç–∞–ø 4):** –ë—É–¥–µ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å "–ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ" –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –í: –ü–æ—á–µ–º—É platform —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ admin/, –∞ –Ω–µ –Ω–∞ site/login (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)?

**–û:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–ª –Ω–∞ `platform` –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–Ω–æ –Ω–µ superAdmin), —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `admin/` –ª–æ–≥–∏—á–Ω–µ–µ:

- –û–Ω —É–≤–∏–¥–∏—Ç —Å–≤–æ–π –¥–∞—à–±–æ—Ä–¥
- –ü–æ–π–º–µ—Ç, —á—Ç–æ —É –Ω–µ–≥–æ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ platform
- –°–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è–º–∏

–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `site/login` –∑–∞–ø—É—Ç–∞–µ—Ç - –æ–Ω –∂–µ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω!

### –í: –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –≤ workspace?

**–û:** –î–≤–∞ —Å–ø–æ—Å–æ–±–∞:

**–°–ø–æ—Å–æ–± 1 (–±—ã—Å—Ç—Ä—ã–π):**

```
workspace ‚Üí header dropdown [–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ ‚ñº]
  ‚Üí –≤—ã–±–æ—Ä –¥—Ä—É–≥–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
  ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookie
  ‚Üí –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ workspace –≤ –Ω–æ–≤–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
```

**–°–ø–æ—Å–æ–± 2 (—á–µ—Ä–µ–∑ admin):**

```
workspace ‚Üí admin (–∫–Ω–æ–ø–∫–∞ –∏–ª–∏ URL)
  ‚Üí —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–π
  ‚Üí [Open Workspace] –Ω–∞ –Ω—É–∂–Ω–æ–º
  ‚Üí workspace –≤ –Ω–æ–≤–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
```

### –í: Cookies —Ä–∞–±–æ—Ç–∞—é—Ç –º–µ–∂–¥—É –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏ –≤ development?

**–û:** –ù–µ—Ç, `localhost` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç domain cookies (`.localhost` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç).

**–†–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

1. **localStorage fallback** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –∫–æ–¥–µ
2. **local.oblikflow.com** - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `/etc/hosts`
3. **staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ** - —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º

**–î–ª—è production:** –†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å `domain=.oblikflow.com`

### –í: –ß—Ç–æ –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è?

**–û:** –ê–≤—Ç–æ–≤—ã–±–æ—Ä –≤ workspace –≤–µ—Ä–Ω–µ—Ç 0 ‚Üí redirect –Ω–∞ `admin/` ‚Üí empty state:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìä Welcome to OblikFlow!               ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ You don't have any enterprises yet.    ‚îÇ
‚îÇ Create your first enterprise to start. ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ [Create Your First Enterprise]         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [ROLES_SYSTEM_ETAP1.md](./ROLES_SYSTEM_ETAP1.md) - –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π (–≠—Ç–∞–ø 1)
- [PERMISSIONS_ETAP1.md](./PERMISSIONS_ETAP1.md) - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ (–≠—Ç–∞–ø 1)
- [DATABASE_SCHEMA_ETAP1.md](./DATABASE_SCHEMA_ETAP1.md) - –°—Ö–µ–º–∞ –ë–î
- [UI_UX_FLOWS_ETAP1.md](./UI_UX_FLOWS_ETAP1.md) - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [IMPLEMENTATION_PLAN_ETAP1.md](./IMPLEMENTATION_PLAN_ETAP1.md) - –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 2.0 (—Å –∞–≤—Ç–æ–≤—ã–±–æ—Ä–æ–º –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è, auth —Ç–æ–ª—å–∫–æ –Ω–∞ site)
